<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>完全版 かな入力タイピングゲーム</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<h1>⌨️ USキーボード向け かな入力タイピングゲーム🎮</h1>


<!-- スタート画面 -->
<div id="startScreen">
  <!-- ユーザー認証セクション -->
  <div id="authSection" style="margin-bottom:20px;">
    <div id="authStatus">
      <p id="authMessage">ゲストでプレイ中</p>
      <button id="loginBtn" style="display:none;">ログイン</button>
      <button id="registerBtn" style="display:none;">ユーザー登録</button>
      <button id="logoutBtn" style="display:none;">ログアウト</button>
    </div>
    
    <!-- ログインフォーム -->
    <div id="loginForm" style="display:none; margin:20px 0; padding:15px; background:rgba(0,0,0,0.3); border-radius:8px;">
      <h3>ログイン</h3>
      <input type="email" id="loginEmail" placeholder="メールアドレス" style="padding:6px; margin:5px; width:200px;">
      <br>
      <input type="password" id="loginPassword" placeholder="パスワード" style="padding:6px; margin:5px; width:200px;">
      <br>
      <button id="loginSubmitBtn">ログイン</button>
      <button id="loginCancelBtn">キャンセル</button>
      <p id="loginStatus" style="margin-top:10px;"></p>
    </div>
    
    <!-- 登録フォーム -->
    <div id="registerForm" style="display:none; margin:20px 0; padding:15px; background:rgba(0,0,0,0.3); border-radius:8px;">
      <h3>ユーザー登録</h3>
      <input type="text" id="registerName" placeholder="表示名（20文字以内）" maxlength="20" style="padding:6px; margin:5px; width:200px;">
      <br>
      <input type="email" id="registerEmail" placeholder="メールアドレス" style="padding:6px; margin:5px; width:200px;">
      <br>
      <input type="password" id="registerPassword" placeholder="パスワード（6文字以上）" style="padding:6px; margin:5px; width:200px;">
      <br>
      <button id="registerSubmitBtn">登録</button>
      <button id="registerCancelBtn">キャンセル</button>
      <p id="registerStatus" style="margin-top:10px;"></p>
    </div>
  </div>
  
  <p>問題数を入力してください：</p>
  <input type="number" id="questionCount" min="1" step="1" value="5">
  <button id="startBtn">スタート</button>
  <p>ちょうど100問を解いた場合、ランキングに投稿できます！</p>
</div>

<!-- HowTo: 下段の遊び方セクション -->
<div id="howTo">
  <h2>📝 遊び方</h2>
  <p>まずは問題数を5くらいで設定してスタートしてください。遊びながら遊び方を知ってください。</p>
  <p>コツ：ホームポジションを意識し、視線は問題文に固定しましょう。</p>
  <h2>📊 スコア計算式</h2>
  <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; margin: 10px 0;">
    <p style="font-family: 'Courier New', monospace; font-size: 18px; margin: 0;">
      <strong>スコア = 平均速度（文字/分） ÷ 平均時間（秒）</strong>
    </p>
    <p style="font-size: 14px; margin: 8px 0 0; opacity: 0.9;">
      より速く、より正確にタイプすることで高スコアを目指せます！
    </p>
  </div>
</div>

<!-- トップページ ランキング -->
<div id="topLeaderboard" style="margin:20px 0;">
  <h3>ランキング（トップ20）</h3>
  <div id="topLeaderboardList">読み込み中...</div>
  <table id="topLeaderboardTable" style="display:none;">
    <thead>
      <tr>
        <th>順位</th>
        <th>名前</th>
        <th>スコア</th>
        <th>平均時間</th>
        <th>総時間</th>
        <th>平均速度</th>
        <th>投稿日時</th>
      </tr>
    </thead>
    <tbody id="topLeaderboardTableBody">
    </tbody>
  </table>
  <hr>
</div>



<!-- ゲーム画面 -->
<div id="gameArea" style="display:none;">
  <div id="problem"></div>
  <!-- <input type="text" id="input" autocomplete="off" autofocus> -->
  <input id="input" type="text" inputmode="none" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" readonly>
  <div id="status">
    <p>問題番号: <span id="questionNumber">1</span></p>
    <p>正確さ: <span id="accuracy">100%</span></p>
    <p>速度: <span id="speed">0 文字/分</span></p>
  </div>

  <!-- 仮想キーボード -->
  <div id="keyboard"></div>
</div>

<!-- スコア画面 -->
<div id="scoreScreen" style="display:none;">
  <h2>🎉 全問クリア！ 🎉</h2>
  <p>スコア: <span id="finalScore"></span></p>
  <p>平均時間: <span id="avgTime"></span> 秒</p>
  <p>平均正確さ: <span id="avgAccuracy"></span>%</p>
  <p>平均速度: <span id="avgSpeed"></span> 文字/分</p>
  <button id="restartBtn">もう一度プレイ</button>

  <div id="postScore" style="margin-top:20px;">
    <h3>ランキングに投稿</h3>
    <input id="playerName" type="text" placeholder="名前" maxlength="20" style="padding:6px;">
    <button id="submitScoreBtn">スコア送信</button>
    <p id="submitStatus"></p>
  </div>

  <div id="leaderboard" style="margin-top:30px;">
    <h3>ランキング（トップ20）</h3>
    <div id="leaderboardList"></div>
    <table id="leaderboardTable" style="display:none;">
      <thead>
        <tr>
          <th>順位</th>
          <th>名前</th>
          <th>スコア</th>
          <th>平均時間</th>
          <th>総時間</th>
          <th>平均速度</th>
          <th>投稿日時</th>
        </tr>
      </thead>
      <tbody id="leaderboardTableBody">
      </tbody>
    </table>
  </div>
</div>



<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="supabaseConfig.js"></script>
<script src="script.js"></script>
</body>
</html>